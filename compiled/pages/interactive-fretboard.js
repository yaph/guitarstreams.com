'use strict';var selected_instrument='guitar';var selected_notes=chromatic_scale.slice();var selected_fret_count=15;var selected_root='C';var selected_mode='major';var selected_chord=null;var highlight_color='#eeeeee';var triad_colors=['#96CBFF','#FFE48E','#FFB28E'];d3.select('input[value="'+selected_instrument+'"]').attr('checked',true);d3.select('#notes').attr('value',selected_notes.join(', '));d3.select('#fret-count').attr('value',selected_fret_count);showFretboard();d3.selectAll('input[name="instrument"]').on('change',function(){selected_instrument=d3.event.target.value;showFretboard()});d3.select('#notes').on('change',function(){selected_notes=d3.event.target.value.split(',').map(function(s){return noteDisplay(s)});showFretboard()});d3.select('#fret-count').on('change',function(){selected_fret_count=d3.max([3,~~d3.event.target.value]);showFretboard()});scaleOptions('#scale-root',chromatic_scale.slice(),function(d){return d||'Root'});scaleOptions('#scale-mode',d3.keys(scales),function(d){return d.replace('_',' ')||'Mode'});function chordButton(chord){return'<h3 class="mt0">'+chord.name+'</h3><div>'+chord.notes.join('\u2012')+'</div>'}function highlightChordButton(){d3.selectAll('.chord-select').style('background-color','#fff');var btn=d3.event.target;var cls=btn.getAttribute('class');if(!cls||!cls.includes('chord-select')){btn=btn.parentElement}d3.select(btn).style('background-color',highlight_color)}function highlightNotes(notes){var colors=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;d3.selectAll('.notes circle').style('fill','#ffffff');for(var idx in notes){var note=notes[idx];var fill=colors?colors[idx]:highlight_color;d3.selectAll('.notes circle[title="'+note+'"]').style('fill',fill)}}function noteDisplay(note){var s=note.trim();return s.charAt(0).toUpperCase()+s.slice(1)}function options(list){list.unshift('');return list}function optionSelected(sid,value){d3.select('#'+sid+' option').attr('selected',null);d3.select('#'+sid+' option[value="'+value+'"]').attr('selected','selected')}function scaleOptions(selector,list,cb_text){d3.select(selector).on('change',setScale).selectAll('option').data(options(list)).enter().append('option').attr('value',function(d){return d}).text(cb_text)}function setChord(chord){selected_chord=chord;highlightChordButton();highlightNotes(selected_chord.notes,triad_colors)}function setChords(scale){d3.select('#chord-family').classed('dn',false).select('.title').text('Chords in the '+scale.root+' '+scale.mode.replace('_',' ')+' scale');var selection=d3.select('#chord-buttons').selectAll('a').data(scale.chord_family);selection.exit().remove();selection.enter().append('a').attr('class','chord-select b--moon-gray ba br2 bw2 dim ma1 pa2 pointer tc w-20').on('click',setChord).html(chordButton);selection.html(chordButton)}function setScale(){var target=d3.event.target;if(!target.value)return;selected_chord=null;d3.selectAll('.chord-select').style('background-color','#fff');if('scale-root'==target.id){selected_root=target.value}else if('scale-mode'==target.id){selected_mode=target.value}optionSelected('scale-root',selected_root);optionSelected('scale-mode',selected_mode);var selected_scale=scale(selected_root,selected_mode);if(selected_scale.notes.length===8){setChords(selected_scale)}selected_notes=selected_scale.notes.slice(0,-1);document.getElementById('notes').value=selected_notes.join(', ');showFretboard()}function showFretboard(){drawFretboard('#fretboard',selected_instrument,selected_notes,selected_fret_count);if(selected_chord){highlightNotes(selected_chord.notes,triad_colors)}}