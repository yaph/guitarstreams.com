'use strict';var alphabet=['A','B','C','D','E','F','G'];var chromatic_scale=['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];var enharmonic_notes={'A':'G##','A#':'Bb','Ab':'G#','B':'Cb','B#':'C','Bb':'A#','C':'B#','C#':'Db','D':'C##','D#':'Eb','Db':'C#','E#':'F','Eb':'D#','F':'E#','F#':'Gb','G':'F##','G#':'Ab','Gb':'F#'};for(var key in enharmonic_notes){enharmonic_notes[enharmonic_notes[key]]=key}var major_roots=['C','G','D','A','E','B','Gb','Db','Ab','Eb','Bb','F'];var minor_roots=['A','E','B','F#','C#','G#','D#','Bb','F','C','G','D'];var roman_numerals=new Map([[1,'\u2160'],[2,'\u2161'],[3,'\u2162'],[4,'\u2163'],[5,'\u2164'],[6,'\u2165'],[7,'\u2166']]);var intervals={P1:{semitones:0,name:'Perfect unison'},d2:{semitones:0,name:'Diminished second'},m2:{semitones:1,name:'Minor second'},A1:{semitones:1,name:'Augmented unison'},M2:{semitones:2,name:'Major second'},d3:{semitones:2,name:'Diminished third'},m3:{semitones:3,name:'Minor third'},A2:{semitones:3,name:'Augmented second'},M3:{semitones:4,name:'Major third'},d4:{semitones:4,name:'Diminished fourth'},P4:{semitones:5,name:'Perfect fourth'},A3:{semitones:5,name:'Augmented third'},d5:{semitones:6,name:'Diminished fifth'},A4:{semitones:6,name:'Augmented fourth'},P5:{semitones:7,name:'Perfect fifth'},d6:{semitones:7,name:'Diminished sixth'},m6:{semitones:8,name:'Minor sixth'},A5:{semitones:8,name:'Augmented fifth'},M6:{semitones:9,name:'Major sixth'},d7:{semitones:9,name:'Diminished seventh'},m7:{semitones:10,name:'Minor seventh'},A6:{semitones:10,name:'Augmented sixth'},M7:{semitones:11,name:'Major seventh'},d8:{semitones:11,name:'Diminished octave'},P8:{semitones:12,name:'Perfect octave'},A7:{semitones:12,name:'Augmented seventh'}};var scales={ionian:['P1','M2','M3','P4','P5','M6','M7','P8'],dorian:['P1','M2','m3','P4','P5','M6','m7','P8'],phrygian:['P1','m2','m3','P4','P5','m6','m7','P8'],lydian:['P1','M2','M3','A4','P5','M6','M7','P8'],mixolydian:['P1','M2','M3','P4','P5','M6','m7','P8'],aeolion:['P1','M2','m3','P4','P5','m6','m7','P8'],locrian:['P1','m2','m3','P4','d5','m6','m7','P8'],harmonic_minor:['P1','M2','m3','P4','P5','m6','M7','P8'],melodic_minor:['P1','M2','m3','P4','P5','M6','M7','P8'],phrygian_dominant:['P1','m2','M3','P4','P5','m6','m7','P8'],major_pentatonic:['P1','M2','M3','P5','M6','P8'],minor_pentatonic:['P1','m3','P4','P5','m7','P8'],blues:['P1','m3','P4','A4','P5','m7','P8']};var chords={'M':['P1','M3','P5'],'m':['P1','m3','P5'],'dim':['P1','m3','d5'],'aug':['P1','M3','A5'],'open5':['P1','P5','P8'],'dim7':['P1','m3','d5','d7'],'maj7':['P1','M3','P5','M7'],'aug7':['P1','M3','A5','m7'],'sus2':['P1','P5','P8','M2'],'sus4':['P1','P5','P8','P4']};var instruments={guitar:{roots:['E','B','G','D','A','E'],string_gauges:[0.01,0.013,0.017,0.026,0.036,0.046],fret_count:15},ukulele:{roots:['A','E','C','G'],string_gauges:[0.024,0.031,0.037,0.026],fret_count:12}};function noteIndex(name){return name.endsWith('b')?chromatic_scale.indexOf(enharmonic_notes[name]):chromatic_scale.indexOf(name)}function noteLabel(name){return name.replace(/b/g,'\u266D').replace(/#/g,'\u266F')}function chordDiagram(chord_index,chord_id,instrument,width){var scale_index=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var name=chord_id;var img_name='';if(chord_id.includes('-')){name=chord_id.split('-')[0];img_name=chord_id}name=noteLabel(name);var display_index=scale_index===null?'':'<span class="o-60">'+roman_numerals.get(scale_index+1)+'</span> ';var positions=chord_index[instrument][name];var has_diagram=false;var href='#';var src='/chord/chord-missing.svg';if('undefined'!==typeof positions){href='/chord/'+instrument+'/'+name.replace('/','-')+'/';if(img_name&&positions.includes(img_name)){has_diagram=true}if(!img_name){img_name=positions[0];has_diagram=true}if(has_diagram){src='/chord/'+instrument+'/'+img_name+'.svg'}}return'<div class="'+width+' fl pr2 pb2"><div class="ba bw2 br2 b--black-10 bg-near-white">\n            <a class="link black" href="'+href+'" title="Click to go to '+name+' '+instrument+' chord overview">\n            <img class="w-100" src="'+src+'" alt="'+name+'">\n            <div class="tc">'+display_index+name+'</div>\n            </a></div></div>'}function getTriad(root,notes){var suffix='';var idx_root=notes.indexOf(root);var idx_third=(idx_root+2)%notes.length;var idx_fifth=(idx_root+4)%notes.length;var third=notes[idx_third];var fifth=notes[idx_fifth];var third_semitones=intervalSemitones(root,third);var fifth_semitones=intervalSemitones(root,fifth);var potential_thirds=[];var potential_fifths=[];for(var idx in intervals){var interval=intervals[idx];interval.id=idx;if(interval.semitones==third_semitones){potential_thirds.push(interval)}else if(interval.semitones==fifth_semitones){potential_fifths.push(interval)}}var found_third=null;var found_fifth=null;for(var _idx in chords){var interval_ids=chords[_idx];if(potential_thirds.map(function(x){return x.id}).includes(interval_ids[1])&&potential_fifths.map(function(x){return x.id}).includes(interval_ids[2])){suffix=_idx;break}}suffix=suffix==='M'?'':suffix;return{name:''+root+suffix,notes:[root,third,fifth]}}function intervalSemitones(note1,note2){var diff=noteIndex(note2)-noteIndex(note1);return diff>=0?diff:chromatic_scale.length+diff}function scale(root){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'major';var offset=noteIndex(root);var alpha_offset=alphabet.indexOf(root[0]);var chord_family=[];var notes=[];var unique_notes=[];for(var i=0;i<scales[mode].length;i++){var interval_id=scales[mode][i];var alpha_index=parseInt(interval_id[1],10)-1;var letter=alphabet[(alpha_offset+alpha_index)%alphabet.length];var interval=intervals[interval_id];var index=(offset+interval.semitones)%chromatic_scale.length;var name=chromatic_scale[index];if(!name.startsWith(letter)){name=enharmonic_notes[name]}notes.push(name)}unique_notes=notes.slice(0,-1);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=unique_notes[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var note=_step.value;chord_family.push(getTriad(note,unique_notes))}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return{chord_family:chord_family,mode:mode,notes:notes,root:root}}